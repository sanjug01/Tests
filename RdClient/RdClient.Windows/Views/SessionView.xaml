<UserControl
    x:Class="RdClient.Views.SessionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RdClient.Views"
    xmlns:controls="using:RdClient.Controls"
    xmlns:vm="using:RdClient.Shared.ViewModels"
    xmlns:input="using:RdClient.Input"
    xmlns:c="using:RdClient.Converters"        
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"    
    >

    <UserControl.DataContext>
        <vm:SessionViewModel x:Name="SessionViewModel">
            <vm:SessionViewModel.MouseViewModel>
                <vm:MouseViewModel/>
            </vm:SessionViewModel.MouseViewModel>
            <vm:SessionViewModel.KeyboardCapture>
                <input:CoreWindowKeyboardCapture/>
            </vm:SessionViewModel.KeyboardCapture>
        </vm:SessionViewModel>
    </UserControl.DataContext>
    
    <UserControl.Resources>
        <c:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>

    <Grid Background="GreenYellow" >
	<!--
        Attach the "Connect" command of the view model to the ConnectCommand
        property of the sesion panel. The session panel will execute the command
        as soon as its swap chain panel will have initialized.
        -->
        <controls:RdSessionPanel ConnectCommand="{Binding ConnectCommand}"
                                 ViewSize="{Binding MouseViewModel.ViewSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

        <controls:MouseLayerControl x:Name="MouseLayer" 
                                    Background="Red"
                                    VerticalContentAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    PointerEventConsumer="{Binding MouseViewModel.PointerEventConsumer}"
                                    MouseShape="{Binding MouseViewModel.MouseShape}"
                                    HotSpot="{Binding MouseViewModel.HotSpot}"
                                    MousePosition="{Binding MouseViewModel.MousePosition}"/>

        <controls:SessionReconnectControl x:Name="SessionReconnectLayer" 
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center"
                                          Visibility="{Binding Path=IsReconnecting, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        
        <Grid Width="Auto" Height="Auto" 
              Background="Transparent"
              Opacity="0.6"
              VerticalAlignment="Top" HorizontalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Button
                Margin="10,0,10,0"
                VerticalContentAlignment="Center"
                Grid.Row="0" Grid.Column="0"
                Height="60"
                FontSize="18"
                Foreground="White"
                Content="{Binding HostName}" 
                Command="{Binding ConnectionBarCommand}"
                VerticalAlignment="Center"/>
        </Grid>

        <controls:ElephantEarsControl             
            ElephantEarsShown="{Binding ElephantEarsShown}"/>
        
        <StackPanel VerticalAlignment="Bottom"
                    HorizontalAlignment="Right" 
                    Orientation="Horizontal">
            
            <TextBox Text="Disconnected. Attempting to reconnect (d)....." 
                     x:Uid="SessionView-ReconnectingMessage"                   
                     Visibility="{Binding Path=IsReconnecting, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            
            <Button
                x:Uid="SessionView-DisconnectButton"
                Command="{Binding DisconnectCommand}"                
                Content="Disconnect (d)"/>
        </StackPanel>
    </Grid>
</UserControl>
